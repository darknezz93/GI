<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Mercator projection</title>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.20/themes/base/jquery-ui.css" type="text/css" media="all" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
        <script src="http://code.jquery.com/ui/1.8.20/jquery-ui.min.js" type="text/javascript"></script>
        <script src="scripts.js"></script>
		<script src="fileutils.js"></script>
		<script src="drawingutils.js"></script>
		<link rel="stylesheet" type="text/css" href="http://localhost:8000/map.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/jquery-ui.css" media="screen" />
	</head>
	<body>


	<div id="container">
		<h1>Mapa Europy</h1>

	</div>
		
		<script type="text/javascript">
			var years = [2014, 2016];
			//all countries
			var countries = ["Austria","Bulgaria","Belgium","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","Germany","Ireland","France","Greece","Spain","Italy","Latvia","Lithuania","Luxembourg","Hungary","Malta","Netherlands","Poland","Portugal","Romania","Slovenia","Slovakia","Sweden","United Kingdom"];
			var currentData = getData(FILE_POPULACJA, countries, years);
			console.log(currentData);
			
			updateColorRange(currentData);
			

			//Width and height
			var w = 800;
			var h = 500;
            
            var div = d3.select("body").append("div")
                      .attr("class", "tooltip")
                      .style("opacity", 0);

			//Define map projection


			var projection = d3.geo.mercator() //utiliser une projection standard pour aplatir les pôles, voir D3 projection plugin
								   .center([ 13, 52 ]) //comment centrer la carte, longitude, latitude
								   .translate([ w/2, h/2 ]) // centrer l'image obtenue dans le svg
								   .scale([ w/1.5 ]); // zoom, plus la valeur est petit plus le zoom est gros 

			//Define path generator
			var path = d3.geo.path()
							 .projection(projection);


			//Create SVG
			var svg = d3.select("#container")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			//Load in GeoJSON data
			d3.json("http://localhost:8000/ne_50m_admin_0_countries_simplified.json", function(json) {
				
				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .attr("stroke", "rgba(8, 81, 156, 0.2)")
				   //.attr("fill", "rgba(8, 81, 156, 0.6)")
				   .attr("fill", function(d) {
						var val = getPlotValue(currentData, d.properties.name, 1);
						if (val == null) { 
							return "rgba(8, 81, 156, 0.6)";
						} else{
							return getColorValue(val);
						}})
                   .on("mouseover", function(d,i) {
                        var value = 1;
                        div.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                        div.html("<b>Nazwa panstwa</b><br/>" + value + "%")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d,i) {
                        div.transition()
                        .duration(500)
                        .style("opacity", 0);
                    });
                
			});
		</script>
        
        <div class="checkboxes">
            <label>Populacja<input type="checkbox"/></label>
            <label>Inflacja<input type="checkbox"/></label>
            <label>Deficyt budżetowy<input type="checkbox"/></label>
            <label>Przychody państwa<input type="checkbox"/></label>
            <label>Wydatki na opiekę socjalną<input type="checkbox"/></label>
            <label>Wydatki państwa<input type="checkbox"/></label>
            <label>Wzrost PKB<input type="checkbox"/></label>
        </div>
        
        <div id="slider">
        <span class="tick">|<br>2010</span>
            <span class="tick" style="left: 20%;">|<br>2011</span>
            <span class="tick" style="left: 40%;">|<br>2012</span>
            <span class="tick" style="left: 60%;">|<br>2013</span>
            <span class="tick" style="left: 80%;">|<br>2014</span>
            <span class="tick" style="left: 100%;">|<br>2015</span>
        </div>
        
	</body>
</html>